<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="uk">
<head>
    <meta charset="UTF-8"/>
    <title>Передбачення групи крові</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <style>
        /* Стилі — в точності як у твоєму шаблоні */
        body {
            font-family: Arial, sans-serif;
            background: #f7f4ec;
            color: #2b2b2b;
            padding: 30px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            gap: 24px;
            justify-content: center;
        }

        .card {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            width: 760px;
        }

        h1, h2, h3 { margin: 0 0 12px 0; }

        .person-card {
            background: #eaf0df;
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .person-info { display:flex; gap:12px; align-items:center; }
        .avatar {
            width:56px; height:56px; border-radius:50%; background:#cfe0b6; display:inline-block;
        }

        .name { font-weight:700; font-size:16px; }
        .muted { color:#666; font-size:13px; }

        .relatives { margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; }
        .rel-item { background:#d7e6c8; padding:8px 12px; border-radius:8px; display:flex; gap:10px; align-items:center; }

        .btn { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; }
        .btn-primary { background:#6b9b54; color:white; }
        .btn-danger { background:#d04a4a; color:white; }
        .btn-ghost { background:transparent; border:1px solid #ddd; color:#333; }

        .form-row { margin-bottom:12px; display:flex; gap:8px; align-items:center; }
        label { font-weight:600; font-size:14px; min-width:110px; }
        select, input[type="text"], input[type="number"] {
            padding:8px; border-radius:6px; border:1px solid #ddd; min-width:0; width:100%;
        }

        .error { color:#a94442; background:#f2dede; padding:8px; border-radius:6px; margin-bottom:12px; }
        hr { border: none; border-top: 1px solid #eee; margin: 12px 0; }

        /* Результат */
        table { width:100%; border-collapse:collapse; margin-top:12px;}
        th, td { border:1px solid #eee; padding:8px; text-align:left; }
        .small { font-size:13px; color:#666; margin-top:6px; }
    </style>
</head>
<body>
<div class="container">
    <div class="card">
        <h1>Передбачення групи крові дитини</h1>
        <p class="muted">Введіть групи батьків (позначені римськими цифрами) та резус, натисніть «Розрахувати».</p>

        <form id="bloodForm" onsubmit="return false;">
            <div class="form-row">
                <label for="fatherType">Батько</label>
                <div style="flex:1;">
                    <div style="display:flex; gap:8px;">
                        <select id="fatherType" aria-label="father-type">
                            <!-- value — внутрішня буква; текст — римська позначка -->
                            <option value="A">II</option>
                            <option value="B">III</option>
                            <option value="AB">IV</option>
                            <option value="O">I</option>
                        </select>

                        <select id="fatherRh" aria-label="father-rh">
                            <option value="+">+</option>
                            <option value="-">-</option>
                        </select>
                    </div>
                    <div class="small">II = A, III = B, IV = AB, I = O</div>
                </div>
            </div>

            <div class="form-row">
                <label for="motherType">Мати / Партнерка</label>
                <div style="flex:1;">
                    <div style="display:flex; gap:8px;">
                        <select id="motherType" aria-label="mother-type">
                            <option value="A">II</option>
                            <option value="B">III</option>
                            <option value="AB">IV</option>
                            <option value="O">I</option>
                        </select>

                        <select id="motherRh" aria-label="mother-rh">
                            <option value="+">+</option>
                            <option value="-">-</option>
                        </select>
                    </div>
                    <div class="small">Якщо відомі точні генотипи — можна додати поле в майбутніх версіях.</div>
                </div>
            </div>

            <div style="display:flex; gap:8px; margin-top:10px;">
                <button id="calc" class="btn btn-primary">Розрахувати</button>
                <button id="reset" class="btn btn-ghost" type="button">Очистити</button>
            </div>
        </form>

        <div id="result" aria-live="polite" style="margin-top:14px;">
            <!-- Результат зʼявиться тут -->
        </div>

        <p class="muted" style="margin-top:12px;"><em>Примітка:</em> це інформаційний калькулятор і не замінює медичну консультацію.</p>
    </div>
</div>

<script>
    // Логіка (працює з A/B/AB/O внутрішньо)
    function genotypePairsFromPhenotype_ABO(phen) {
        phen = (phen || '').toUpperCase();
        if (phen === 'A') return [['A','A'], ['A','O']];
        if (phen === 'B') return [['B','B'], ['B','O']];
        if (phen === 'AB') return [['A','B']];
        if (phen === 'O') return [['O','O']];
        return [['O','O']];
    }

    function genotypePairsFromPhenotype_Rh(rh) {
        if (rh === '+') return [['D','D'], ['D','d']];
        return [['d','d']];
    }

    function combineParents(fGenotypes, mGenotypes) {
        const childABOcounts = {'A':0,'B':0,'AB':0,'O':0};
        const weightPerPair = 1/(fGenotypes.length * mGenotypes.length);

        for (const fg of fGenotypes) {
            for (const mg of mGenotypes) {
                for (const a of fg) {
                    for (const b of mg) {
                        const child = [a,b].sort().join('');
                        let ph;
                        if (child === 'AB') ph = 'AB';
                        else if (child.includes('A') && !child.includes('B')) ph = 'A';
                        else if (child.includes('B') && !child.includes('A')) ph = 'B';
                        else ph = 'O';
                        childABOcounts[ph] += weightPerPair * 0.25;
                    }
                }
            }
        }
        return childABOcounts;
    }

    function combineRh(fRhGenotypes, mRhGenotypes) {
        const counts = {'+':0,'-':0};
        const weight = 1/(fRhGenotypes.length * mRhGenotypes.length);
        for (const fg of fRhGenotypes) {
            for (const mg of mRhGenotypes) {
                for (const fa of fg) {
                    for (const ma of mg) {
                        const ph = ([fa,ma].includes('D')) ? '+' : '-';
                        counts[ph] += weight * 0.25;
                    }
                }
            }
        }
        return counts;
    }

    const roman = {'A':'II','B':'III','AB':'IV','O':'I'};

    function renderResult(aboCounts, rhCounts) {
        const totalAbo = Object.values(aboCounts).reduce((s,v)=>s+v,0) || 1;
        const pct = {};
        Object.keys(aboCounts).forEach(k => {
            pct[k] = Math.round((aboCounts[k]/totalAbo)*1000)/10;
        });
        const totalRh = (rhCounts['+'] + rhCounts['-']) || 1;
        const rhPct = {
            '+': Math.round((rhCounts['+']/totalRh)*1000)/10,
            '-': Math.round((rhCounts['-']/totalRh)*1000)/10
        };

        const out = document.getElementById('result');
        out.innerHTML = `
            <h3>Результат</h3>
            <table>
              <tr><th>Група крові (римська)</th><th>Ймовірність</th></tr>
              <tr><td>${roman['A']}</td><td>${pct['A']}%</td></tr>
              <tr><td>${roman['B']}</td><td>${pct['B']}%</td></tr>
              <tr><td>${roman['AB']}</td><td>${pct['AB']}%</td></tr>
              <tr><td>${roman['O']}</td><td>${pct['O']}%</td></tr>
            </table>

            <table>
              <tr><th>Rh</th><th>Ймовірність</th></tr>
              <tr><td>+</td><td>${rhPct['+']}%</td></tr>
              <tr><td>-</td><td>${rhPct['-']}%</td></tr>
            </table>
        `;
    }

    function clearResult() { document.getElementById('result').innerHTML = ''; }

    document.getElementById('calc').addEventListener('click', () => {
        const fType = document.getElementById('fatherType').value || 'O';
        const mType = document.getElementById('motherType').value || 'O';
        const fRh = document.getElementById('fatherRh').value || '+';
        const mRh = document.getElementById('motherRh').value || '+';

        const fABO = genotypePairsFromPhenotype_ABO(fType);
        const mABO = genotypePairsFromPhenotype_ABO(mType);
        const fRhG = genotypePairsFromPhenotype_Rh(fRh);
        const mRhG = genotypePairsFromPhenotype_Rh(mRh);

        const aboCounts = combineParents(fABO, mABO);
        const rhCounts = combineRh(fRhG, mRhG);

        renderResult(aboCounts, rhCounts);
    });

    document.getElementById('reset').addEventListener('click', () => {
        document.getElementById('fatherType').value = 'A';
        document.getElementById('motherType').value = 'A';
        document.getElementById('fatherRh').value = '+';
        document.getElementById('motherRh').value = '+';
        clearResult();
    });

    // Ініціалізація
    clearResult();
</script>
</body>
</html>
