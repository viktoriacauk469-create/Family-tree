<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Передбачення групи крові дитини</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 760px; margin: 24px auto; padding: 12px; }
        .row { display:flex; gap:12px; }
        .card { padding:12px; border:1px solid #ddd; border-radius:8px; flex:1; }
        label { display:block; margin-top:8px; }
        button { margin-top:12px; padding:8px 12px; }
        table { width:100%; border-collapse:collapse; margin-top:12px;}
        th, td { border:1px solid #eee; padding:8px; text-align:left; }
    </style>
</head>
<body>
<h1>Передбачення групи крові дитини</h1>
<div class="row">
    <div class="card">
        <h3>Батько</h3>
        <label>Група
            <select id="fatherType">
                <option>A</option><option>B</option><option>AB</option><option>O</option>
            </select>
        </label>
        <label>Rh
            <select id="fatherRh"><option>+</option><option>-</option></select>
        </label>
    </div>
    <div class="card">
        <h3>Мати / Партнерка</h3>
        <label>Група
            <select id="motherType">
                <option>A</option><option>B</option><option>AB</option><option>O</option>
            </select>
        </label>
        <label>Rh
            <select id="motherRh"><option>+</option><option>-</option></select>
        </label>
    </div>
</div>

<button id="calc">Розрахувати</button>

<div id="result"></div>

<script>
    /* Допоміжні функції */
    function possibleABOGenotypes(phen) {
        phen = phen.toUpperCase();
        if (phen === 'A') return ['A','O'].map(a=>[a]); // treat as alleles list per genotype? We'll return genotype alleles pairs below
        if (phen === 'B') return ['B','O'].map(a=>[a]);
        if (phen === 'AB') return [['A','B']];
        if (phen === 'O') return [['O','O']];
        return [['O','O']];
    }
    // We'll return list of genotype pairs (each as array [allele1, allele2])
    function genotypePairsFromPhenotype_ABO(phen) {
        phen = phen.toUpperCase();
        if (phen === 'A') return [['A','A'], ['A','O']];
        if (phen === 'B') return [['B','B'], ['B','O']];
        if (phen === 'AB') return [['A','B']];
        if (phen === 'O') return [['O','O']];
        return [['O','O']];
    }
    function genotypePairsFromPhenotype_Rh(rh) {
        if (rh === '+') return [['D','D'], ['D','d']];
        return [['d','d']];
    }

    /* Основна логіка: перебір всіх пар генотипів і всіх передач алелей */
    function combineParents(fGenotypes, mGenotypes) {
        // fGenotypes: array of genotype pairs, e.g. [['A','O'], ['A','A']]
        // mGenotypes similar
        const childABOcounts = {'A':0,'B':0,'AB':0,'O':0};
        const childRhCounts = {'+':0,'-':0};
        let totalComb = 0;

        // assume equal prior probability for each parental genotype (we could weight but simplest is equal)
        const weightPerPair = 1/(fGenotypes.length * mGenotypes.length);

        for (const fg of fGenotypes) {
            for (const mg of mGenotypes) {
                // alleles from father: fg[0] or fg[1]
                // alleles from mother: mg[0] or mg[1]
                for (const a of fg) {
                    for (const b of mg) {
                        const childAlleles = [a,b].sort().join(''); // e.g. 'AO' or 'AB' or 'OO'
                        // determine phenotype ABO
                        let ph;
                        if (childAlleles === 'AB' || childAlleles === 'BA') ph = 'AB';
                        else if (childAlleles.includes('A') && !childAlleles.includes('B')) {
                            ph = childAlleles === 'AA' || childAlleles === 'A A' ? 'A' : 'A';
                            // both AA and AO -> A
                            ph = 'A';
                        } else if (childAlleles.includes('B') && !childAlleles.includes('A')) {
                            ph = 'B';
                        } else ph = 'O';
                        childABOcounts[ph] += weightPerPair * 0.25; // because 1/4 from allele combination (each allele equally likely)
                        totalComb += weightPerPair * 0.25;
                    }
                }
            }
        }

        return {childABOcounts, totalComb};
    }

    /* Rh separate combine: simpler enumeration */
    function combineRh(fRhGenotypes, mRhGenotypes) {
        const counts = {'+':0,'-':0};
        const weight = 1/(fRhGenotypes.length * mRhGenotypes.length);
        for (const fg of fRhGenotypes) {
            for (const mg of mRhGenotypes) {
                // each genotype is [x,y] alleles (D or d)
                for (const fa of fg) {
                    for (const ma of mg) {
                        // child genotype
                        const child = [fa, ma];
                        // phenotype + if any 'D'
                        const ph = (child.includes('D')) ? '+' : '-';
                        counts[ph] += weight * 0.25;
                    }
                }
            }
        }
        return counts;
    }

    document.getElementById('calc').addEventListener('click', ()=>{
        const fType = document.getElementById('fatherType').value;
        const mType = document.getElementById('motherType').value;
        const fRh = document.getElementById('fatherRh').value;
        const mRh = document.getElementById('motherRh').value;

        const fABO = genotypePairsFromPhenotype_ABO(fType);
        const mABO = genotypePairsFromPhenotype_ABO(mType);
        const fRhG = genotypePairsFromPhenotype_Rh(fRh);
        const mRhG = genotypePairsFromPhenotype_Rh(mRh);

        const aboRes = combineParents(fABO, mABO);
        const rhRes = combineRh(fRhG, mRhG);

        // normalize to percentages
        const total = Object.values(aboRes.childABOcounts).reduce((s,v)=>s+v,0);
        const percent = {};
        for (const k of Object.keys(aboRes.childABOcounts)) {
            percent[k] = Math.round((aboRes.childABOcounts[k] / total) * 1000)/10; // 1 decimal
        }
        const totalRh = rhRes['+'] + rhRes['-'];
        const rhPercent = {
            '+': Math.round((rhRes['+']/totalRh)*1000)/10,
            '-': Math.round((rhRes['-']/totalRh)*1000)/10
        };

        // render
        const out = document.getElementById('result');
        out.innerHTML = `
    <h3>Результат</h3>
    <table>
      <tr><th>Група крові</th><th>Ймовірність</th></tr>
      <tr><td>A</td><td>${percent['A']}%</td></tr>
      <tr><td>B</td><td>${percent['B']}%</td></tr>
      <tr><td>AB</td><td>${percent['AB']}%</td></tr>
      <tr><td>O</td><td>${percent['O']}%</td></tr>
    </table>

    <table>
      <tr><th>Rh</th><th>Ймовірність</th></tr>
      <tr><td>+</td><td>${rhPercent['+']}%</td></tr>
      <tr><td>-</td><td>${rhPercent['-']}%</td></tr>
    </table>

    <p><em>Примітка:</em> Якщо відомі точні генотипи батьків, введіть їх вручну в код (вдоскональни цей приклад). Результат — наближені ймовірності.</p>
  `;
    });
</script>
</body>
</html>
