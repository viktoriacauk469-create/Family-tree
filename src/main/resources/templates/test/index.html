<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Передбачення групи крові дитини</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 760px; margin: 24px auto; padding: 12px; }
        .row { display:flex; gap:12px; }
        .card { padding:12px; border:1px solid #ddd; border-radius:8px; flex:1; }
        label { display:block; margin-top:8px; }
        button { margin-top:12px; padding:8px 12px; }
        table { width:100%; border-collapse:collapse; margin-top:12px;}
        th, td { border:1px solid #eee; padding:8px; text-align:left; }
    </style>
</head>
<body>
<h1>Передбачення групи крові дитини</h1>
<div class="row">
    <div class="card">
        <h3>Батько</h3>
        <label>Група
            <select id="fatherType">
                <option value="A">II</option>
                <option value="B">III</option>
                <option value="AB">IV</option>
                <option value="O">I</option>
            </select>
        </label>
        <label>Rh
            <select id="fatherRh"><option>+</option><option>-</option></select>
        </label>
    </div>
    <div class="card">
        <h3>Мати / Партнерка</h3>
        <label>Група
            <select id="motherType">
                <option value="A">II</option>
                <option value="B">III</option>
                <option value="AB">IV</option>
                <option value="O">I</option>
            </select>
        </label>
        <label>Rh
            <select id="motherRh"><option>+</option><option>-</option></select>
        </label>
    </div>
</div>

<button id="calc">Розрахувати</button>

<div id="result"></div>

<script>
    function genotypePairsFromPhenotype_ABO(phen) {
        phen = phen.toUpperCase();
        if (phen === 'A') return [['A','A'], ['A','O']];
        if (phen === 'B') return [['B','B'], ['B','O']];
        if (phen === 'AB') return [['A','B']];
        if (phen === 'O') return [['O','O']];
        return [['O','O']];
    }

    function genotypePairsFromPhenotype_Rh(rh) {
        if (rh === '+') return [['D','D'], ['D','d']];
        return [['d','d']];
    }

    function combineParents(fGenotypes, mGenotypes) {
        const childABOcounts = {'A':0,'B':0,'AB':0,'O':0};
        let totalComb = 0;
        const weightPerPair = 1/(fGenotypes.length * mGenotypes.length);

        for (const fg of fGenotypes) {
            for (const mg of mGenotypes) {
                for (const a of fg) {
                    for (const b of mg) {
                        const child = [a,b].sort().join('');
                        let ph;
                        if (child === 'AB') ph = 'AB';
                        else if (child.includes('A') && !child.includes('B')) ph = 'A';
                        else if (child.includes('B') && !child.includes('A')) ph = 'B';
                        else ph = 'O';
                        childABOcounts[ph] += weightPerPair * 0.25;
                        totalComb += weightPerPair * 0.25;
                    }
                }
            }
        }
        return {childABOcounts, totalComb};
    }

    function combineRh(fRhGenotypes, mRhGenotypes) {
        const counts = {'+':0,'-':0};
        const weight = 1/(fRhGenotypes.length * mRhGenotypes.length);
        for (const fg of fRhGenotypes) {
            for (const mg of mRhGenotypes) {
                for (const fa of fg) {
                    for (const ma of mg) {
                        const ph = ([fa,ma].includes('D')) ? '+' : '-';
                        counts[ph] += weight * 0.25;
                    }
                }
            }
        }
        return counts;
    }

    // Мапа для римських груп
    const roman = {
        'A': 'II',
        'B': 'III',
        'AB': 'IV',
        'O': 'I'
    };

    document.getElementById('calc').addEventListener('click', ()=>{
        const fType = document.getElementById('fatherType').value;
        const mType = document.getElementById('motherType').value;
        const fRh = document.getElementById('fatherRh').value;
        const mRh = document.getElementById('motherRh').value;

        const fABO = genotypePairsFromPhenotype_ABO(fType);
        const mABO = genotypePairsFromPhenotype_ABO(mType);
        const fRhG = genotypePairsFromPhenotype_Rh(fRh);
        const mRhG = genotypePairsFromPhenotype_Rh(mRh);

        const aboRes = combineParents(fABO, mABO);
        const rhRes = combineRh(fRhG, mRhG);

        const total = Object.values(aboRes.childABOcounts).reduce((s,v)=>s+v,0);
        const percent = {};
        for (const k of Object.keys(aboRes.childABOcounts)) {
            percent[k] = Math.round((aboRes.childABOcounts[k] / total) * 1000)/10;
        }

        const totalRh = rhRes['+'] + rhRes['-'];
        const rhPercent = {
            '+': Math.round((rhRes['+']/totalRh)*1000)/10,
            '-': Math.round((rhRes['-']/totalRh)*1000)/10
        };

        const out = document.getElementById('result');
        out.innerHTML = `
    <h3>Результат</h3>
    <table>
      <tr><th>Група крові</th><th>Ймовірність</th></tr>
      <tr><td>${roman['A']}</td><td>${percent['A']}%</td></tr>
      <tr><td>${roman['B']}</td><td>${percent['B']}%</td></tr>
      <tr><td>${roman['AB']}</td><td>${percent['AB']}%</td></tr>
      <tr><td>${roman['O']}</td><td>${percent['O']}%</td></tr>
    </table>

    <table>
      <tr><th>Rh</th><th>Ймовірність</th></tr>
      <tr><td>+</td><td>${rhPercent['+']}%</td></tr>
      <tr><td>-</td><td>${rhPercent['-']}%</td></tr>
    </table>
  `;
    });
</script>
</body>
</html>
