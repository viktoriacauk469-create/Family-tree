<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="uk">
<head>
    <meta charset="UTF-8"/>
    <title>Родичі</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <style>
        /* Твої стилі (без змін) */
        body { font-family: Arial, sans-serif; background: #f7f4ec; color: #2b2b2b; padding: 30px; }
        .container { max-width: 1100px; margin: 0 auto; display: flex; gap: 24px; }
        .left, .right { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
        .left { flex: 1; } .right { width: 420px; }
        .person-card { background: #eaf0df; padding: 14px; border-radius: 10px; margin-bottom: 12px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
        .person-info { display:flex; gap:12px; align-items:center; }
        .avatar { width:56px; height:56px; border-radius:50%; background:#cfe0b6; display:inline-block; }
        .name { font-weight:700; font-size:16px; } .muted { color:#666; font-size:13px; }
        .relatives { margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; }
        .rel-item { background:#d7e6c8; padding:8px 12px; border-radius:8px; display:flex; gap:10px; align-items:center; }
        .btn { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; }
        .btn-primary { background:#6b9b54; color:white; }
        .btn-danger { background:#d04a4a; color:white; }
        .btn-ghost { background:transparent; border:1px solid #ddd; color:#333; }
        .form-row { margin-bottom:12px; display:flex; gap:8px; align-items:center; }
        label { font-weight:600; font-size:14px; min-width:110px; }
        select, input[type="text"], input[type="number"] { padding:8px; border-radius:6px; border:1px solid #ddd; min-width:0; width:100%; }
        .error { color:#a94442; background:#f2dede; padding:8px; border-radius:6px; margin-bottom:12px; }
        hr { border: none; border-top: 1px solid #eee; margin: 12px 0; }
        .top-actions { display:flex; justify-content:flex-end; gap:8px; margin-bottom:12px; }
    </style>
</head>
<body>
<div class="container">

    <div class="left">
        <div class="top-actions">
            <!-- Глобальна кнопка -- веде на сторінку передбачення -->
            <a th:href="@{/dashboard/prediction}" class="btn btn-primary" title="Передбачення групи крові">Передбачення групи крові</a>
        </div>

        <h2>Ваші люди</h2>

        <div th:if="${error}" class="error" th:text="${error}"></div>

        <div th:if="${#lists.isEmpty(userPersonals)}">
            <p class="muted">У вас ще немає персональних записів.</p>
        </div>

        <div th:each="p : ${userPersonals}">
            <div class="person-card">
                <div class="person-info">
                    <span class="avatar" th:if="${p.firstName == null}"></span>
                    <div>
                        <div class="name" th:text="${p.firstName} + ' ' + ${p.lastName}">Ім'я Прізвище</div>
                        <div class="muted">Вік: <span th:text="${p.age}">—</span></div>
                    </div>
                </div>

                <div style="display:flex; gap:8px; align-items:center;">
                    <form th:action="@{/relatives/remove}" method="post" th:object="${p}" style="display:inline;">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <input type="hidden" name="personId" th:value="${p.id}"/>
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Видалити цю персону?')">Delete</button>
                    </form>

                    <!-- Кнопка: відкрити деталі -->
                    <a th:href="@{/relatives(userId=${userId}, selectedPersonId=${p.id})}" class="btn btn-ghost">Відкрити</a>

                    <!-- Нова кнопка: Розрахувати передбачення використовуючи цю персону (передаємо personId як motherId) -->
                    <a th:href="@{/dashboard/prediction(personId=${p.id})}" class="btn btn-primary">Розрахувати для цієї персони</a>
                </div>
            </div>

            <div>
                <div class="muted">Родичі:</div>
                <div class="relatives">
                    <div th:each="r : ${p.relatives}" class="rel-item">
                        <div>
                            <strong th:text="${r.firstName} + ' ' + ${r.lastName}">Родич</strong>
                            <div class="muted" th:text="${r.age}">age</div>
                        </div>
                    </div>
                </div>
            </div>

            <hr/>
        </div>
    </div>

    <div class="right">
        <h3>Додати персону</h3>

        <a th:href="@{/user/profile}" title="Профіль" style="display:inline-flex; align-items:center; gap:8px; text-decoration:none;">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="border-radius:50%; background:#cfe0b6; padding:6px;">
                <path d="M12 12c2.761 0 5-2.239 5-5s-2.239-5-5-5-5 2.239-5 5 2.239 5 5 5z" fill="#fff"/>
                <path d="M3 20c0-3.866 3.582-7 9-7s9 3.134 9 7v1H3v-1z" fill="#fff"/>
            </svg>
        </a>

        <p class="muted">Оберіть вашу персону (якщо потрібно) та введіть дані нового запису.</p>

        <form th:action="@{/relatives/add}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <div class="form-row">
                <label for="relativeFirstName">Ім'я</label>
                <input type="text" id="relativeFirstName" name="relativeFirstName" placeholder="Ім'я" required/>
            </div>

            <div class="form-row">
                <label for="relativeLastName">Прізвище</label>
                <input type="text" id="relativeLastName" name="relativeLastName" placeholder="Прізвище" required/>
            </div>

            <div class="form-row">
                <label for="relativeAge">Вік</label>
                <input type="number" id="relativeAge" name="relativeAge" placeholder="Вік" min="0" required/>
            </div>

            <div style="margin-top:12px;">
                <button type="submit" class="btn btn-primary">Додати персону</button>
            </div>
        </form>

            <div style="margin-top:12px;">
                <button type="submit" class="btn btn-primary">Додати персону</button>
            </div>
        </form>
    </div>
</div>
</body>
</html>
